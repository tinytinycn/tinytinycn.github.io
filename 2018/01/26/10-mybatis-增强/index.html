<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 10_mybatis_增强 · hang 's blogs</title><meta name="description" content="10_mybatis_增强 - hang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/tinytinycn.github.io/favicon.png"><link rel="stylesheet" href="/tinytinycn.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://github.com/atom.xml" title="hang 's blogs"></head><body><div class="wrap"><header><a href="/tinytinycn.github.io/" class="logo-link"><img src="/tinytinycn.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/tinytinycn.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">10_mybatis_增强</h1><div class="post-info">Jan 26, 2018</div><div class="post-content"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li>Mybatis 增强<ul>
<li>核心配置文件</li>
<li>核心业务操作</li>
<li>映射文件</li>
</ul>
</li>
<li>Mybtis 应用<ul>
<li>日志配置及应用</li>
<li>缓存配置及应用</li>
<li>动态sql 应用</li>
</ul>
</li>
</ul>
<hr>
<h2 id="核心配置文件"><a href="#核心配置文件" class="headerlink" title="核心配置文件"></a>核心配置文件</h2><p>mybatis 配置文件包含 行为设置settings 和 属性信息properties.</p>
<p>文档顶层结构:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">configuration 配置</span><br><span class="line">properties 属性</span><br><span class="line">setting 设置</span><br><span class="line">typeAliases 类型别名</span><br><span class="line">typeHandler 类型处理器</span><br><span class="line">objectFactory 对象工厂</span><br><span class="line">plugins 插件</span><br><span class="line">environments 环境</span><br><span class="line">transactionManager 事务管理器</span><br><span class="line">dataSource 数据源</span><br><span class="line">databaseIdProvider 数据库厂商标识</span><br><span class="line">mappers 映射器</span><br></pre></td></tr></table></figure>

<p>properties属性标签:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//资源目录resources/config.properties 配置文件</span><br><span class="line">driver=com.mysql.jdbc.Driver</span><br><span class="line">url=jdbc:mysql:///test</span><br><span class="line">username=root</span><br><span class="line">password=root</span><br><span class="line"></span><br><span class="line">//mybaits核心配置中, 引入上述配置信息</span><br><span class="line">&lt;properties resource=&quot;config.properties&quot;/&gt;</span><br><span class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line">  &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</span><br><span class="line">  &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</span><br><span class="line">&lt;/dataSource&gt;</span><br><span class="line">//配置更为灵活</span><br></pre></td></tr></table></figure>

<p>settings设置标签:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//设置调整, 如缓存,延迟加载等</span><br><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;multipleResultSetsEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;useColumnLabel&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;useGeneratedKeys&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;autoMappingBehavior&quot; value=&quot;PARTIAL&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;autoMappingUnknownColumnBehavior&quot; value=&quot;WARNING&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultExecutorType&quot; value=&quot;SIMPLE&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultStatementTimeout&quot; value=&quot;25&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;defaultFetchSize&quot; value=&quot;100&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;safeRowBoundsEnabled&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;false&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;localCacheScope&quot; value=&quot;SESSION&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;jdbcTypeForNull&quot; value=&quot;OTHER&quot;/&gt;</span><br><span class="line">  &lt;setting name=&quot;lazyLoadTriggerMethods&quot;</span><br><span class="line">  value=&quot;equals,clone,hashCode,toString&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<p>typeAliases别名标签:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//类型别名, 为Java类设置一个别名, 降低类限定名的冗余</span><br><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Author&quot; type=&quot;domain.blog.Author&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Blog&quot; type=&quot;domain.blog.Blog&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Comment&quot; type=&quot;domain.blog.Comment&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Post&quot; type=&quot;domain.blog.Post&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Section&quot; type=&quot;domain.blog.Section&quot;/&gt;</span><br><span class="line">  &lt;typeAlias alias=&quot;Tag&quot; type=&quot;domain.blog.Tag&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//指定包名, mybatis自动搜索包下bean对象</span><br><span class="line">&lt;typeAliases&gt;</span><br><span class="line">  &lt;package name=&quot;cn.tinytiny.xxx.xxx.entity&quot;/&gt;</span><br><span class="line">&lt;/typeAliases&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//Java类型内置类的别名</span><br><span class="line">//别名      映射类型</span><br><span class="line">iterator		Iterator</span><br><span class="line">collection		Collection</span><br><span class="line">arraylist		ArrayList</span><br><span class="line">list	List</span><br><span class="line">hashmap	HashMap</span><br><span class="line">map		Map</span><br><span class="line">bigdecimal	BigDecimal</span><br><span class="line">decimal	BigDecimal</span><br><span class="line">date	Date</span><br><span class="line">boolean	Boolean</span><br><span class="line">float	Float</span><br><span class="line">double	Double</span><br><span class="line">integer	Integer</span><br><span class="line">int		Integer</span><br><span class="line">short	Short</span><br><span class="line">long	Long</span><br><span class="line">byte	Byte</span><br><span class="line">string	String</span><br><span class="line">boolean	boolean</span><br></pre></td></tr></table></figure>

<h2 id="业务操作"><a href="#业务操作" class="headerlink" title="业务操作"></a>业务操作</h2><ul>
<li><p>定义实体对象</p>
</li>
<li><p>创建mapper映射文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#&#123;&#125;,$&#123;&#125;区别?</span><br><span class="line">同: 获取接口方法参数中的数据</span><br><span class="line">异:</span><br><span class="line">1. $&#123;&#125;表达式 获取参数时, 参数必须使用@Param注解修饰</span><br><span class="line">2. $&#123;&#125;表达式 可以获取xxx.properties配置中的数据</span><br><span class="line">3. $&#123;&#125;表达式 获取参数时, 直接将参数值拼接到sql语句中, 存在sql注入问题</span><br><span class="line">(@Param String s)  s=&quot;xxx&apos;or 1=1&apos;&quot; --&gt; where name =&apos;xxx&apos;or 1=1&apos;&apos;</span><br><span class="line">4. $&#123;&#125;表达式 假如在SQL语句中应用，应尽量使用参数值替换语句中的表名，字段名而不是字段的具体值</span><br><span class="line"></span><br><span class="line">5. #&#123;&#125;表达式 获取参数时, 不存在sql注入</span><br><span class="line">6. #&#123;&#125;表达式 在mybatis解析sql语句时, #自动替换为? ,PreparedStatement预处理次sql, 提高性能.</span><br></pre></td></tr></table></figure>
</li>
<li><p>单元测试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//sqlSession对象对mybatis的事务进行控制, SqlSessionFactory工厂通过openSession()获得的sqlsession对象默认是手动提交事务.</span><br><span class="line">//对于insert/update/delete操作, 执行结束后需要手动提交事务, 执行sqlSession.commit()方法.</span><br><span class="line">//使用openSession(true)方法, 可以自动控制事务</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="映射文件"><a href="#映射文件" class="headerlink" title="映射文件"></a>映射文件</h2><p>mybatis映射器的xml文件相对简单, 简化JDBC编程.</p>
<p>映射文件顶层元素:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cache 给定命名空间的缓存配置</span><br><span class="line">cache-ref 其他命名空间的缓存引用</span><br><span class="line">resultMap 描述如何从数据库结果集中, 加载对象</span><br><span class="line">sql 可被其他语句引用的重复语句块(借助&lt;include/&gt;)</span><br><span class="line">insert 映射插入语句</span><br><span class="line">upadte 映射更新语句</span><br><span class="line">select 映射查询语句</span><br><span class="line">delete 映射删除语句</span><br></pre></td></tr></table></figure>

<p>select插入标签:</p>
<ul>
<li>parameterType: 传给该语句的参数类(完全限定名或别名, 该属性可选.mybatis可以通过Typehandler推断传入语句的参数)</li>
<li>resultType: 返回的期望类型(完全限定名或别名.注意:结果是集合,则返回类型为集合包含元素的类型,并非集合本身类型)</li>
<li>resultMap: 外部resultMap的命名引用(涉及结果集映射的场景), 注意: resutlMap和resultType不能同时使用.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 当查询结果与映射对象字段不匹配时, 使用resultMap 做映射转换!</span><br><span class="line">//SysUser(id,username,password) &lt;&lt; (user_id,user_name,hashed_password)</span><br><span class="line">&lt;resultMap id=&quot;userResultMap&quot; type=&quot;sysUser&quot;&gt;</span><br><span class="line">  &lt;id property=&quot;id&quot; column=&quot;user_id&quot; /&gt;</span><br><span class="line">  &lt;result property=&quot;username&quot; column=&quot;user_name&quot;/&gt;</span><br><span class="line">  &lt;result property=&quot;password&quot; column=&quot;hashed_password&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line">&lt;select id=&quot;selectUsers&quot; resultMap=&quot;userResultMap&quot;&gt;</span><br><span class="line">  select user_id, user_name, hashed_password</span><br><span class="line">  from some_table</span><br><span class="line">  where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>insert/update/delete标签:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//mysql或sqlServer 支持自动生成主键的字段</span><br><span class="line">&lt;insert id=&quot;insertObject&quot; parameterType=&quot;sysUser&quot;</span><br><span class="line">        useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;&gt;</span><br><span class="line">  insert into sys_users(id,username,password,phone,createdDate,modifiedDate)</span><br><span class="line">  values(null,#&#123;username&#125;,#&#123;password&#125;,#&#123;phone&#125;,now(),now())</span><br><span class="line">&lt;/insert&gt;</span><br><span class="line"></span><br><span class="line">&lt;update id=&quot;updateObject&quot; parameterType=&quot;sysUser&quot;&gt;</span><br><span class="line">  update sys_users</span><br><span class="line">  set phone=#&#123;phone&#125;,modifiedDate=now()</span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br><span class="line"></span><br><span class="line">&lt;delete id=&quot;deleteOjbect&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">  delete from sysUser where id=#&#123;id&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<p>sql标签:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//定义重用sql的代码块</span><br><span class="line">&lt;sql id=&quot;orderBy&quot;&gt;</span><br><span class="line">  order by $&#123;columnName&#125;</span><br><span class="line">&lt;/sql&gt;</span><br><span class="line">&lt;select id=&quot;findUsers&quot; resultType=&quot;sysUser&quot;&gt;</span><br><span class="line">  select * from sys_users</span><br><span class="line">  &lt;include refid=&quot;orderBy&quot;/&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h2 id="日志配置及应用"><a href="#日志配置及应用" class="headerlink" title="日志配置及应用"></a>日志配置及应用</h2><p>mybatis 内置的日志工厂提供日志功能. 具体日志实现工具:</p>
<ul>
<li>SLF4J(日志框架标准,类似JDBC标准)</li>
<li>Apache Commons Logging</li>
<li>Log4j 2 (是log4j的升级版,配置文件升级为xml格式了)</li>
<li>Log4j(日志处理库,配置文件格式为.properties)</li>
<li>DK logging<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">具体选择哪个日志实现工具由MyBatis的内置日志工厂确定。</span><br><span class="line">它会使用最先找到的（按上文列举的顺序查找）。</span><br><span class="line">如果一个都未找到，日志功能就会被禁用。</span><br><span class="line">如果你的应用部署在一个包含Commons Logging的环境，</span><br><span class="line">而你又想用其他的日志框架，你可以通过在MyBatis的配置文件mybatis-config.</span><br><span class="line">xml里面添加一项setting（配置）来选择一个不同的日志实现.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li><p>添加log4j依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;log4j&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;log4j&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.17&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加/resources/log4j.properties配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=INFO,stdout</span><br><span class="line">log4j.appender.stdout=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.stdout.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.stdout.layout.ConversionPattern=%d [%-5p] %c - %m%n</span><br><span class="line"></span><br><span class="line">log4j.logger.com.mybatis3=DEBUG</span><br><span class="line">//添加自己的工程包路径</span><br><span class="line">log4j.logger.cn.tinytiny=DEBUG</span><br></pre></td></tr></table></figure>
</li>
<li><p>mybatis核心配置文件添加配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4j&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="缓存配置及应用"><a href="#缓存配置及应用" class="headerlink" title="缓存配置及应用"></a>缓存配置及应用</h2><p>mybatis 提供查询缓存的功能.</p>
<ul>
<li>默认情况, 开启一级缓存(sqlSession级别)</li>
<li>若开启二级缓存(sqlSessionFactory级别)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//核心配置文件, 开启缓存</span><br><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br><span class="line"></span><br><span class="line">//核心映射文件, 添加cache标签</span><br><span class="line">//eviction 回收策略</span><br><span class="line">//flushInterval 刷新间隔</span><br><span class="line">//size 引用数目</span><br><span class="line">//readOnly 只读属性, 设置true则返回调用者缓存对象的相同实例(可能被修改).设置false则返回调用者缓存对象的拷贝(安全,默认false)</span><br><span class="line">&lt;cache eviction=&quot;LRU&quot; flushInterval=&quot;60000&quot; size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;</span><br><span class="line"></span><br><span class="line">//共享相同缓存配置和实例, 使用cache-ref</span><br><span class="line">&lt;cache-ref namespace=&quot;com.someone.application.data.SomeMapper&quot;/&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="动态sql-应用"><a href="#动态sql-应用" class="headerlink" title="动态sql 应用"></a>动态sql 应用</h2><p>根据不同业务场景, 动态拼接sql语句.</p>
<p>if元素:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//if语句进行条件判断</span><br><span class="line">//接口方法</span><br><span class="line">List&lt;SysUser&gt; findUsers(@Param(&quot;columnName&quot;),String columnName,@Param(&quot;ph&quot;),String phone);</span><br><span class="line">//mapper映射</span><br><span class="line">&lt;select id=&quot;findUsers&quot;</span><br><span class="line">  resultType=&quot;sysUser&quot;&gt;</span><br><span class="line">  select *</span><br><span class="line">  &lt;include refid=&quot;fromTable&quot;/&gt;</span><br><span class="line">  where id&gt;0</span><br><span class="line">  &lt;if test=&quot;ph!=null and ph!=&apos;&apos;&quot;&gt;</span><br><span class="line">    and phone=#&#123;ph&#125;</span><br><span class="line">  &lt;/if&gt;</span><br><span class="line">  order by $&#123;columnName&#125;  desc</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>where元素:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//where语句定义查询条件</span><br><span class="line">&lt;select id=&quot;findUsers&quot; resultType=&quot;sysUser&quot;&gt;</span><br><span class="line">  SELECT * FROM SYS_USERS</span><br><span class="line">  &lt;where&gt;</span><br><span class="line">    &lt;if test=&quot;id != null&quot;&gt;</span><br><span class="line">       and id&gt;#&#123;id&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;phone != null&quot;&gt;</span><br><span class="line">       and phone like #&#123;phone&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;username != null and username !=&apos;&apos;&quot;&gt;</span><br><span class="line">       AND username like concat(&quot;%&quot;,#&#123;username&#125;,&quot;%&quot;)</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>foreach元素:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//foreach语句用于迭代参数数据</span><br><span class="line">//接口方法</span><br><span class="line">int deleteObject(@Param(&quot;id&quot;) String[] ids);</span><br><span class="line">//mapper映射</span><br><span class="line">&lt;delete id=&quot;deleteObjectById&quot;&gt;</span><br><span class="line">  delete from sys_users</span><br><span class="line">  where id in</span><br><span class="line">  &lt;foreach collection=&quot;ids&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;</span><br><span class="line">  item=&quot;item&quot;&gt;</span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/tinytinycn.github.io/2018/01/28/11-Ajax/" class="prev">PREV</a><a href="/tinytinycn.github.io/2018/01/25/09-mybatis-整合/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://github.com">hang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>