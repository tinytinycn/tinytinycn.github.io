<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 04_spring_MVC_basic · hang 's blogs</title><meta name="description" content="04_spring_MVC_basic - hang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/tinytinycn.github.io/favicon.png"><link rel="stylesheet" href="/tinytinycn.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://github.com/atom.xml" title="hang 's blogs"></head><body><div class="wrap"><header><a href="/tinytinycn.github.io/" class="logo-link"><img src="/tinytinycn.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/tinytinycn.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">04_spring_MVC_basic</h1><div class="post-info">Jan 19, 2018</div><div class="post-content"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li>Spring MVC</li>
<li>Spring MVC 的基本实现</li>
<li>Spring MVC 请求处理</li>
<li>Spring MVC 响应处理</li>
<li>Spring MVC 处理流程</li>
</ul>
<hr>
<h2 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h2><ul>
<li>前提: Spring 框架在企业级应用中, 解决了一些细节问题. 如: 参数获取和校验, 值的注入, 响应方式和数据格式的转换等.</li>
<li>传统MVC: 优势: 结构层次清晰,可读性可维护性较好; 劣势: 参数获取,类型转换,流程调用较复杂.</li>
<li>现代MVC 框架: spring mvc, struts2, …</li>
<li>Spring MVC: (底层核心架构图)</li>
</ul>
<p><img src="spring-mvc-struct.png" alt="spring-mvc"><br>DispatcherServlet: 前端控制器, 处理请求的入口</p>
<p>HandlerMapping: 映射器, 管理url和controller的映射关系</p>
<p>Controller: 后端控制器, 处理请求的控制逻辑</p>
<p>ModelAndView: 模型, 封装业务处理的结果和视图</p>
<p>ViewResovler: 视图解析器, 解析对应的视图(匹配前缀+view+匹配后缀)</p>
<h2 id="Spring-MVC-的基本实现"><a href="#Spring-MVC-的基本实现" class="headerlink" title="Spring MVC 的基本实现"></a>Spring MVC 的基本实现</h2><ol>
<li>创建maven web项目, 添加项目依赖</li>
<li>配置web.xml文件, 创建前端控制器DispatcherServlet, 配置相关</li>
<li>创建后端控制器类Controller</li>
<li>添加相关页面</li>
<li>配置spring配置文件, 配置应用组件</li>
<li>部署和测试</li>
</ol>
<p>基于xml方式实现:</p>
<ol>
<li><p>创建maven web项目, pom.xml添加依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;4.3.9.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置web.xml文件, 配置DispatcherServlet</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//前置控制器一般需要在服务器启动时, 初始化</span><br><span class="line"></span><br><span class="line">&lt;servlet&gt;</span><br><span class="line">  &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">  &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">  &lt;!--serlvet初始化加载配置--&gt;</span><br><span class="line">  &lt;init-param&gt;</span><br><span class="line">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">    &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;</span><br><span class="line">  &lt;/init-param&gt;</span><br><span class="line">  &lt;!--启动时加载该servlet--&gt;</span><br><span class="line">  &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">  &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;</span><br><span class="line">  &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建后端控制器类Controller, 实现Controller接口, 重写方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//ModelAndView 为模型与视图对象, 内置map对象, 封装业务数据和视图名</span><br><span class="line">//ModelAndView 构造方法传递视图名</span><br><span class="line">//ModelAndView addObject()存储数据</span><br><span class="line">//返回对象, 自动被spring mvc 存储到请求作用域, 在对应视图中获取对应数值.</span><br><span class="line">public class HelloController implements Controller&#123;</span><br><span class="line">	public ModelAndView handleRequest(HttpServletRequest request) &#123;</span><br><span class="line">		ModelAndView mv=new ModelAndView(&quot;hello&quot;);</span><br><span class="line">		mv.addObject(&quot;message&quot;,&quot;helloworld&quot;);</span><br><span class="line">		return mv;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加相关视图, /WEB-INF/pages/xxx.jsp文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">…</span><br><span class="line">&lt;body&gt;</span><br><span class="line">   &lt;h1&gt;$&#123;message&#125;&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">…</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置spring配置文件, /resource目录下spring-mvc.xml文件添加:<br>??如何快速生成spring 配置文件,而不是复制上一个项目的??</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--开启自动扫描--&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;cn.tinytiny&quot;/&gt;</span><br><span class="line">&lt;!--开启mvc注解--&gt;</span><br><span class="line">&lt;mvc:annotation-driven/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--后端controller--&gt;</span><br><span class="line">&lt;bean id=&quot;helloController&quot; class=&quot;cn.tinytiny.controller.HelloController&quot;/&gt;</span><br><span class="line">&lt;!--配置handlerMapping, 处理 url到controller的映射--&gt;</span><br><span class="line">&lt;bean class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;mappings&quot;&gt;</span><br><span class="line">        &lt;props&gt;</span><br><span class="line">            &lt;prop key=&quot;/hello.do&quot;&gt;helloController&lt;/prop&gt;</span><br><span class="line">        &lt;/props&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!--配置viewResolver--&gt;</span><br><span class="line">&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署和测试<br>启动tomacat服务器, 浏览器输入url访问业务</p>
</li>
</ol>
<p>运行原理:</p>
<p><img src="spring-mvc-xml.png" alt="spring-mvc-xml"></p>
<p>注解方式实现:</p>
<ol>
<li><p>创建 maven web项目, 添加依赖(同上)</p>
</li>
<li><p>配置web.xml文件, 配置DispatcherServlet</p>
</li>
<li><p>创建后端控制器类Controller, 添加@Controller注解和@RequestMapping注解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//@RequestMapping注解定义url到controller具体方法的映射</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/&quot;)</span><br><span class="line">public class AnnotationHelloController &#123;</span><br><span class="line">	@RequestMapping(&quot;doSayHello&quot;)</span><br><span class="line">	public String doSayHello() &#123;</span><br><span class="line">		ModelAndView mv=new ModelAndView(&quot;hello&quot;);</span><br><span class="line">		mv.addObject(&quot;message&quot;, &quot;helloworld&quot;);</span><br><span class="line">		return &quot;hello&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加相关视图, /WEB-INF/pages/xxx.jsp文件(同上)</p>
</li>
<li><p>配置spring配置文件, /resource目录下spring-mvc.xml文件添加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 配置组件扫描 --&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;com.company&quot;/&gt;</span><br><span class="line">&lt;!—启用MVC注解扫描 --&gt;</span><br><span class="line">&lt;mvc:annotation-driven/&gt;</span><br><span class="line">&lt;!-- 配置视图解析器 --&gt;</span><br><span class="line">&lt;bean  id=&quot;viewResolver&quot;</span><br><span class="line">     class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">     &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;</span><br><span class="line">     &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署和测试<br>启动tomacat服务器, 浏览器输入url访问业务</p>
</li>
</ol>
<h2 id="Spring-MVC-请求处理"><a href="#Spring-MVC-请求处理" class="headerlink" title="Spring MVC 请求处理"></a>Spring MVC 请求处理</h2><ul>
<li><p>请求路径映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping 注解定义映射路径.(应用于类定义或方法定义处)</span><br><span class="line">//多个url可以映射到同一个controller的处理方法</span><br><span class="line">@RequestMapping(value=&#123;&quot;/doSayHello&quot;,&quot;/sys/doSayBye&quot;&#125;)</span><br><span class="line"></span><br><span class="line">//REST 即表述性状态传递(Representational State Transfer): 软件架构编码风格, 基于网络应用进行设计和开发的编码方式.</span><br><span class="line">@RequestMapping(&quot;/msg/&#123;xxx&#125;&quot;) //匹配url:/msg/abc 或/msg/abcdef等</span><br><span class="line">@RequestMapping(&quot;/msg/&#123;id&#125;/create&quot;) //匹配url:/msg/1/create</span><br><span class="line">@RequestMapping(&quot;/msg/&#123;mId&#125;/topics/&#123;tId&#125;&quot;) //匹配url:/msg/1/topics/12</span><br><span class="line">@PathVariable 可以提取URI模板模式中的&#123;xxx&#125;中的xxx变量</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求方法映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping method属性指定具体的请求方式或多种请求方式</span><br><span class="line">@RequestMapping(value=&quot;doSaveObj&quot;, method=RequestMethod.POST)</span><br><span class="line">@RequestMapping(value=&quot;doSaveObj&quot;, method=&#123;RequestMethod.POST,RequestMethod.GET)</span><br></pre></td></tr></table></figure>
</li>
<li><p>请求参数映射</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">//使用Servlet API中对象, 获取参数数据, 如HttpServletRequest,HttpSession等</span><br><span class="line">//@ResponseBody注解作用：该注解作用于将Controller的方法返回的对象，通过适当的HttpMessageConverter转换为指定格式后，写入到Response对象的body数据区，使用情况：返回的数据不是Html标签的页面，而是其他数据格式的数据时，（如Json、xml，普通文本等）使用.</span><br><span class="line">@RequestMapping(value=&quot;request&quot;,method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withRequest(HttpServletRequest request)&#123;</span><br><span class="line">		System.out.println(request.getRequestURI());</span><br><span class="line">		return &quot;value: &quot;+request.getParameter(&quot;gid&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">//使用直接量, 接收参数数据, 但参数变量类型必需为对象类型</span><br><span class="line">//@RequestParam 注解用于接收请求参数中名字为foo的参数值，假如请求参数名与方法中的参数名一致，@RequestParam注解可以省略。假如不一致则可以使用@RequestParam注解定义新的参数名直接接收页面数据，然后传递给方法名</span><br><span class="line">//属性required=false表示，该参数可以不存在. 若为true，参数不存在时会抛出异常.</span><br><span class="line">@RequestMapping(value=&quot;param&quot;,method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withParam(@RequestParam String foo) &#123;</span><br><span class="line">	return &quot;Obtained &apos;foo&apos; query parameter value &apos;&quot; + foo + &quot;&apos;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value=&quot;param&quot;, method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withParam(</span><br><span class="line">@RequestParam(value=&quot;param1&quot;,required=false) String foo) &#123;</span><br><span class="line">		return &quot;Obtained &apos;foo&apos; query parameter value &apos;&quot; + foo + &quot;&apos;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用Java Bean对象, 接收多个参数数据, 简化多参数变量定义</span><br><span class="line">//bean中需要有与参数名对应的set方法</span><br><span class="line">@RequestMapping(value=&quot;group&quot;,method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withParamGroup(Message bean) &#123;</span><br><span class="line">		return &quot;Obtained parameter group &quot; + bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用Rest url中的数据, 将动态url中的可变参数直接注入方法对应参数中去</span><br><span class="line">//@PathVariable注解指定参数变量var获取请求url中&#123;var&#125;数据</span><br><span class="line">@RequestMapping(value=&quot;path/&#123;var&#125;&quot;,method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withPathVariable(@PathVariable String var) &#123;</span><br><span class="line">	return &quot;value: &quot; + var;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//使用请求头数据, 获取请求头中的数据绑定到方法参数中去</span><br><span class="line">//@RequestHeader即可将请求头的属性值绑定到处理方法的入参中</span><br><span class="line">//当应用中要获取请求中所有数据时可以在请求方法中定义一个HttpEntity&lt;String&gt;参数，通过此参数获取请求头及请求体中数据.</span><br><span class="line">@RequestMapping(value=&quot;header&quot;, method=RequestMethod.GET)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String withHeader(@RequestHeader String Accept) &#123;</span><br><span class="line">		return &quot;value: &quot; + Accept;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RequestMapping(value=&quot;entity&quot;, method=RequestMethod.POST)</span><br><span class="line">public @ResponseBody String withEntity(HttpEntity&lt;String&gt; entity) &#123;</span><br><span class="line">		return &quot;request body: &quot; + entity.getBody() + &quot;headers: &quot; + entity.getHeaders();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Spring-MVC-响应处理"><a href="#Spring-MVC-响应处理" class="headerlink" title="Spring MVC 响应处理"></a>Spring MVC 响应处理</h2><ul>
<li><p>响应数据的封装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">//借助ModelAndrView对象封装.</span><br><span class="line">//ModelAndView对象由Spring创建, 当服务器对响应数据封装时, 将数据存储到ModelAndView对象的Modelmap类型的属性中</span><br><span class="line">@RequestMapping(&quot;doModelAndView&quot;)</span><br><span class="line">public ModelAndView doModelAndView(ModelAndView mv) &#123;</span><br><span class="line">  //ModelAndView mv=new ModelAndView();</span><br><span class="line">		mv.addObject(&quot;data&quot;, &quot;model and view&quot;);</span><br><span class="line">		mv.setViewName(&quot;back&quot;);</span><br><span class="line">		return mv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//借助Model对象封装.</span><br><span class="line">//当返回具体View时，系统底层会自动将model对象存储到request作用域</span><br><span class="line">@RequestMapping(&quot;doModel&quot;)</span><br><span class="line">public String doModel(Model model) &#123;</span><br><span class="line">		model.addAttribute(&quot;data&quot;, &quot;modal&quot;);</span><br><span class="line">		return &quot;back&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//借助Map对象封装.</span><br><span class="line">//若使用map对象封装数据, 可以直接采用model对象封装</span><br><span class="line">@RequestMapping(&quot;doMap&quot;)</span><br><span class="line">public String doMap(Map&lt;String,Object&gt; map) &#123;</span><br><span class="line">	map.put(&quot;data&quot;, &quot;map..&quot;);</span><br><span class="line">	return &quot;back&quot;;</span><br><span class="line">&#125;</span><br><span class="line">//使用@RequestParam注解, 可以通过map接收页面参数</span><br><span class="line">@RequestMapping(&quot;doMap&quot;)</span><br><span class="line">public String doMap(@RequestParam Map&lt;String,Object&gt; map) &#123;</span><br><span class="line">	map.put(&quot;data&quot;, &quot;map..&quot;);</span><br><span class="line">	return &quot;back&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>响应数据的转换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">//JSON: JavaScript Object Notation 轻量级数据交换格式, 用于客户端和服务端的数据传输.</span><br><span class="line"></span><br><span class="line">//客户端操作json</span><br><span class="line">//JSON.parse()       json格式字符串&gt;&gt;json对象</span><br><span class="line">//JSON.stringify()   json对象&gt;&gt;json格式字符串</span><br><span class="line"></span><br><span class="line">//json对象</span><br><span class="line">var json = &#123;id:666,name:&apos;tiny&apos;,age:25&#125;</span><br><span class="line">var json2 = [&#123;id:666,name:&apos;tiny&apos;,age:25&#125;,&#123;id:777,name:&apos;tiny2&apos;,age:24&#125;]</span><br><span class="line">var x = json.id;</span><br><span class="line">var y = json2[1].id;</span><br><span class="line">JSON.stringify(json);</span><br><span class="line">JSON.parse(&apos;[&#123;&quot;id&quot;:666,&quot;name&quot;:&quot;tiny&quot;,&quot;age&quot;:25&#125;,&#123;&quot;id&quot;:777,&quot;name&quot;:&quot;tiny2&quot;,&quot;age&quot;:24&#125;]&apos;);</span><br><span class="line"></span><br><span class="line">//服务端操作json</span><br><span class="line">//通常服务器端返回响应数据直接转换成json格式字符串, 客户端再将字符串转换成json对象, 最后取值.</span><br><span class="line">//添加第三方JSON API库(jackson/fastjson),实现java对象和JSON字符串的转换</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.8.5&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">或</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.2.44&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">//jackson</span><br><span class="line">//对象转换器(jackson)</span><br><span class="line">ObjectMapper om=new ObjectMapper();</span><br><span class="line">//map/list/Object&gt;&gt;json字符串</span><br><span class="line">String s1=om.writeValueAsString(map);</span><br><span class="line">System.out.println(s1</span><br><span class="line"></span><br><span class="line">//fastjson</span><br><span class="line">//map/list/Object&gt;&gt;json字符串</span><br><span class="line">String s1=JSON.toJSONString(map);</span><br><span class="line">System.out.println(s1);</span><br><span class="line">//json字符串&gt;&gt;map/list/Object</span><br><span class="line">Map&lt;?,?&gt; map2 = JSON.parseObject(s1, Map.class);</span><br><span class="line">System.out.println(map2);  </span><br><span class="line"></span><br><span class="line">//Spring 集成jackson</span><br><span class="line">- 添加依赖</span><br><span class="line">- 创建controller, 添加对应方法, 返回map对象(spring底层会直接访问jackson api将对象转换为字符串)</span><br><span class="line">//map&gt;&gt;json</span><br><span class="line">@RequestMapping(&quot;doMap&quot;)</span><br><span class="line">  @ResponseBody</span><br><span class="line">public Map&lt;String,Object&gt; doMap()&#123;</span><br><span class="line">    Map&lt;String,Object&gt; map=</span><br><span class="line">  		  new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;id&quot;, 100);</span><br><span class="line">    map.put(&quot;name&quot;, &quot;AAA&quot;);</span><br><span class="line">    return map;</span><br><span class="line">&#125;</span><br><span class="line">//javaBean&gt;&gt;json</span><br><span class="line">@RequestMapping(&quot;doUser&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public SysUser doUser()&#123;</span><br><span class="line">    SysUser user=new SysUser();</span><br><span class="line">    user.setId(100);</span><br><span class="line">    user.setUsername(&quot;CCC&quot;);</span><br><span class="line">    user.setPassword(&quot;123456&quot;);</span><br><span class="line">    return user;</span><br><span class="line">&#125;</span><br><span class="line">//list&gt;&gt;json</span><br><span class="line">@RequestMapping(&quot;doList&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public List&lt;SysUser&gt; doList()&#123;</span><br><span class="line">    List&lt;SysUser&gt; list=new ArrayList&lt;&gt;();</span><br><span class="line">    SysUser user=new SysUser();</span><br><span class="line">    user.setId(100);</span><br><span class="line">    user.setUsername(&quot;CCC&quot;);</span><br><span class="line">    user.setPassword(&quot;123456&quot;);</span><br><span class="line">    list.add(user);</span><br><span class="line">    user=new SysUser();</span><br><span class="line">    user.setId(200);</span><br><span class="line">    user.setUsername(&quot;DDD&quot;);</span><br><span class="line">    user.setPassword(&quot;123&quot;);</span><br><span class="line">    list.add(user);</span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//Spring 集成fastjson</span><br><span class="line">- 添加依赖</span><br><span class="line">- 创建controller, 添加相应方法, 返回map对象(手动代码转换json)</span><br><span class="line">@RequestMapping(&quot;doFastMap&quot;)</span><br><span class="line">@ResponseBody</span><br><span class="line">public String doFastMap()&#123;</span><br><span class="line">    Map&lt;String,Object&gt; map=</span><br><span class="line">  		  new HashMap&lt;&gt;();</span><br><span class="line">    map.put(&quot;id&quot;, 100);</span><br><span class="line">    map.put(&quot;name&quot;, &quot;AAA&quot;);</span><br><span class="line">    return JSON.toJSONString(map);</span><br><span class="line">&#125;</span><br><span class="line">或者spring配置如下:</span><br><span class="line">&lt;!--开启自动扫描--&gt;</span><br><span class="line">&lt;context:component-scan base-package=&quot;cn.tinytiny&quot;/&gt;</span><br><span class="line">&lt;!--开启mvc注解--&gt;</span><br><span class="line">&lt;mvc:annotation-driven&gt;</span><br><span class="line">    &lt;mvc:message-converters&gt;</span><br><span class="line">        &lt;bean class=&quot;com.alibaba.fastjson.support.spring.FastJsonHttpMessageConverter&quot;/&gt;</span><br><span class="line">    &lt;/mvc:message-converters&gt;</span><br><span class="line">&lt;/mvc:annotation-driven&gt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="Spring-MVC-处理流程"><a href="#Spring-MVC-处理流程" class="headerlink" title="Spring MVC 处理流程"></a>Spring MVC 处理流程</h2><p>Spring工作流程描述</p>
<ol>
<li>用户向服务器发送请求, 请求被Spring 前端控制器DispatcherServlet捕获;</li>
<li>DispatcherServlet对请求URL进行解析, 得到请求资源标识符（URI）。然后根据该URI, 调用HandlerMapping获得该Handler配置的所有相关的对象(包括Handler对象以及Handler对象对应的拦截器), 最后以HandlerExecutionChain对象的形式返回;</li>
<li>DispatcherServlet 根据获得的Handler，选择一个合适的HandlerAdapter。(附注：如果成功获得HandlerAdapter后，此时将开始执行拦截器的preHandler(…)方法)</li>
<li>提取Request中的模型数据，填充Handler入参，开始执行Handler（Controller). 在填充Handler的入参过程中，根据你的配置，Spring将帮你做一些额外的工作:</li>
</ol>
<ul>
<li>HttpMessageConveter: 将请求消息（如Json、xml等数据）转换成一个对象, 将对象转换为指定的响应信息;</li>
<li>数据转换: 对请求消息进行数据转换。如String转换成Integer、Double等;</li>
<li>数据格式化: 对请求消息进行数据格式化。 如将字符串转换成格式化数字或格式化日期等;</li>
</ul>
<ol start="5">
<li>Handler执行完成后，向DispatcherServlet 返回一个ModelAndView对象；</li>
<li>根据返回的ModelAndView，选择一个适合的ViewResolver(必须是已经注册到Spring容器中的ViewResolver)返回给DispatcherServlet;</li>
<li>ViewResolver 结合Model和View, 来渲染视图;</li>
<li>将渲染结果返回给客户端.</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/tinytinycn.github.io/2018/01/21/05-spring-MVC-inteceptor/" class="prev">上一篇</a><a href="/tinytinycn.github.io/2018/01/19/03-spring-AOP/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://github.com">hang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>