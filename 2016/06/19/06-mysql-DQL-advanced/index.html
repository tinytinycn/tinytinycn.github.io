<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 06_mysql_DQL_advanced · hang 's blogs</title><meta name="description" content="06_mysql_DQL_advanced - hang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/tinytinycn.github.io/favicon.png"><link rel="stylesheet" href="/tinytinycn.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://github.com/atom.xml" title="hang 's blogs"></head><body><div class="wrap"><header><a href="/tinytinycn.github.io/" class="logo-link"><img src="/tinytinycn.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/tinytinycn.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">06_mysql_DQL_advanced</h1><div class="post-info">Jun 19, 2016</div><div class="post-content"><h1 id="DQL-advanced"><a href="#DQL-advanced" class="headerlink" title="DQL_advanced"></a>DQL_advanced</h1><ul>
<li>子查询</li>
<li>连接查询</li>
<li>mysql 标准连接语法</li>
<li>视图</li>
</ul>
<hr>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><p>子查询允许把一个查询嵌套在另一个查询当中.</p>
<p>子查询,又叫内部查询.相对于外部查询,包含内部查询的就称为外部查询.</p>
<ul>
<li>where 子查询<br>用一个查询的结果,作为另一个查询的过滤条件.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">select id,name,salary</span><br><span class="line">  from employees</span><br><span class="line">  where salary=(select min(salary) from employees);</span><br><span class="line"></span><br><span class="line">//符号后面为条件,单值多值取决 上一次查询数据结果,单行多行取决 上一次查询字段数目.</span><br><span class="line">//单列单值子查询   = &lt;&gt; &gt; &lt;</span><br><span class="line">//单列多值子查询</span><br><span class="line">in     (是否在其中,在,则返回TRUE) 同=any</span><br><span class="line">not in (同&lt;&gt;all )</span><br><span class="line">all (所有的)   &gt;all   大于所有值则返回TRUE</span><br><span class="line">any (任意一个) &gt;any   大于任意值则返回TRUE</span><br><span class="line">//多列单值/多值子查询     (a,b) in ...</span><br><span class="line">```  </span><br><span class="line">- from 子查询(行内视图)</span><br><span class="line">把内层查询的结果,供给外层再次查询.</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>//挂科两门以上的学生名字和挂科数目<br>select name,count(<em>) as gg from S<br>  where score&lt;60<br>  group by name<br>  having gg&gt;=2;<br>//挂科学生中,姓李的同学<br>select name<br>  from (select name,count(</em>) as gg from S where ….) as t   //必须取别名**<br>  where name like ‘李%’;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 字段列表 子查询</span><br></pre></td></tr></table></figure>

<p>select a,b,(select …from …) from…;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- exits 子查询</span><br><span class="line">把外层查询的结果,供给内层查询,是否成立</span><br></pre></td></tr></table></figure>

<p>//学生对应的学号/姓名/分数<br>//内层查找 有成绩的学生(怎么知道id 001的学生又没成绩?外层传入id到内部查询,类”全局变量”)<br>//外层查找 详细信息<br>select id,name,score from Students<br>  where exists(<br>    select * from Scores where Scores.id=Students.id;<br>    );</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- 独立子查询和 相关子查询</span><br><span class="line">子查询依赖外部查询的某些字段，这就导致子查询就依赖外部查询，就产生了相关性.</span><br><span class="line"></span><br><span class="line">使用独立子查询，如果子查询部分对集合的最大遍历次数为n，外部查询的最大遍历次数为m时，我们可以记为：O(m+n)。而如果使用相关子查询，它的遍历次数可能会达到O(m+m*n)。可以看到，效率就会成倍的下降；所以，在使用子查询时，一定要考虑到子查询的相关性。</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line">连接查询</span><br><span class="line">--</span><br><span class="line">将多张表(&gt;=2)进行记录的连接(按照某个指定的条件进行数据拼接).</span><br><span class="line"></span><br><span class="line">连接查询的意义: 在用户查看数据的时候,需要显示的数据来自多张表.</span><br><span class="line">- 交叉连接</span><br></pre></td></tr></table></figure>

<p>select *<br>  from left_table cross join right_table;<br>或<br>select *<br>  from left_table,right_table;<br>//<br>//最终结果:笛卡尔积  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 内连接(见下)</span><br></pre></td></tr></table></figure>

<p>select *<br>  from left_table [inner] join right_table on left_table.字段=right_table.字段;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 外连接(见下)</span><br></pre></td></tr></table></figure>

<p>select *<br>  from left_table left/right join right_table on left_table.字段=right_table.字段;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- 自然连接(略)</span><br><span class="line"></span><br><span class="line">- 多表连接查询</span><br><span class="line">用外键将多张表连接成一张大表</span><br></pre></td></tr></table></figure>

<p>select a.xx,a.yy,a.zz, b.uu,b.vv<br>  from a,b<br>  where a.id=b.mid;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- 自连接查询</span><br><span class="line">外键与本表中的主键连接; 将一张表看做是两张表</span><br></pre></td></tr></table></figure>

<p>select a.xx,b.yy<br>  from emp a,emp b<br>  where a.id=b.id;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 标准的sql语句 **连接语法**</span><br></pre></td></tr></table></figure>

<p>//内连接: 等值连接<br>select …<br>  from<br>    a inner join b on a.id=b.mid<br>      inner join c on c.id=a.mid<br>      [inner] join d on …<br>      [inner] join e on …</p>
<p>//外链接: 连接条件以外的数据,也显示出来<br>select …<br>  from<br>  a left [outer] join b on …<br>  a right [outer] join b on …</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">![inner join](img_innerjoin.gif)</span><br><span class="line"></span><br><span class="line">![left join](img_leftjoin.gif)</span><br><span class="line"></span><br><span class="line">![right join](img_rightjoin.gif)</span><br><span class="line"></span><br><span class="line">- 视图</span><br><span class="line">将一个查询结果保存到数据库中;</span><br></pre></td></tr></table></figure>

<p>//作用:<br>//简化查询<br>//安全: 创建视图给用户访问,让低权限用户只能查询,不能触碰真实数据表<br>//一般只从视图查询,不对视图做增删改操作<br>create [or replace] view view000                   – 创建视图<br>  as<br>    select … from …;<br>show tables;                          – 查看视图,同表<br>desc view000;<br>show create view view000;<br>drop view view000;                    – 删除视图    </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 行内视图</span><br><span class="line">从一个查询的结果中 再查询;行内视图后必须加一个别名;</span><br></pre></td></tr></table></figure>

<p>select … from (select … from …) 别名1 ;</p>
<pre><code></code></pre></div></article></div></main><footer><div class="paginator"><a href="/tinytinycn.github.io/2016/06/20/07-mysql-transaction/" class="prev">上一篇</a><a href="/tinytinycn.github.io/2016/06/18/05-mysql-function/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://github.com">hang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>