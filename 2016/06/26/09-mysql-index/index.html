<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 09_mysql_index · hang 's blogs</title><meta name="description" content="09_mysql_index - hang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/tinytinycn.github.io/favicon.png"><link rel="stylesheet" href="/tinytinycn.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://github.com/atom.xml" title="hang 's blogs"></head><body><div class="wrap"><header><a href="/tinytinycn.github.io/" class="logo-link"><img src="/tinytinycn.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/tinytinycn.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">09_mysql_index</h1><div class="post-info">Jun 26, 2016</div><div class="post-content"><h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><ul>
<li>是什么? 特殊文件,表空间的组成部分,包含数据表所有记录的引用指针.(通俗说法,一本书的”目录”) ps:笔记整理</li>
<li>为什么? 数据量大,查询速度慢,对多个数据表经常查询的字段建立索引,优化查询.(修改表时,由于存在大量数据,创建索引过程需要时间.)</li>
<li>怎么做? 创建/查询/删除索引操作</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">普通索引</span><br><span class="line">唯一索引</span><br><span class="line">全文索引</span><br><span class="line">主键索引</span><br><span class="line">单列索引/多列索引</span><br><span class="line">组合索引(最左前缀)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//普通索引 index</span><br><span class="line">create index index_name on tinytable(name);  -- 创建</span><br><span class="line">create table tinytable(</span><br><span class="line">  id int not null auto_increment,</span><br><span class="line">  name char(255),</span><br><span class="line">  primary key (id),</span><br><span class="line">  index [index_name](name)</span><br><span class="line">  );</span><br><span class="line">alter table tinytable add index [index_name] on (name);</span><br><span class="line"></span><br><span class="line">show create table tinytable\G                -- 查询</span><br><span class="line">show index from tinytable;</span><br><span class="line"></span><br><span class="line">drop index index_name on tinytable;          -- 删除</span><br><span class="line">alter table tinytable drop index index_name;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//唯一索引 unique</span><br><span class="line">create unique index index_name on tinytable(name);</span><br><span class="line">create table tinytable(</span><br><span class="line">  id int auto_increment,</span><br><span class="line">  name char(255),</span><br><span class="line">  primary key (id),</span><br><span class="line">  unique [index_name] (name)</span><br><span class="line">  );</span><br><span class="line">alter table tinytable add unique [index_name] on (name);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//全文索引 fulltext</span><br><span class="line">//mysql 3.23.23版本开始支持全文索引和全文检索,仅用于myisam表.(切记对大容量数据表生成全文索引是非诚消耗时间消耗空间的做法.)</span><br><span class="line">create fulltext index index_content on tinytable(content);</span><br><span class="line">create table tinytable(</span><br><span class="line">  id int auto_increment,</span><br><span class="line">  name char(255),</span><br><span class="line">  content text,</span><br><span class="line">  primary key(id),</span><br><span class="line">  unique [index_name](name),</span><br><span class="line">  fulltext [index_content](content)</span><br><span class="line">  );</span><br><span class="line">alter table tinytable add fulltext index_content(content);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//主键索引</span><br><span class="line">alter table tinytable add primary key (id);</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//单列索引/多列索引</span><br><span class="line">//多个单列索引和单个多列索引 查询效果不同. 因为mysql只能使用一个索引进行查询, 会从多个索引中选择一个最为严格的索引.</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//组合索引</span><br><span class="line">//建立组合索引,相当于建立了如下索引: x,y 和 x (最左前缀,从最左开始组合,没有y索引.)</span><br><span class="line">create index index_name on tinytable(x,y);</span><br><span class="line">alter table tinytable add index index_x_y(x,y);</span><br></pre></td></tr></table></figure>

<h2 id="滥用索引"><a href="#滥用索引" class="headerlink" title="滥用索引"></a>滥用索引</h2><ul>
<li>索引提高了查询时的速度,同时降低了更新表的速度.(如 insert/update/delete操作,因为不仅要保存数据,还好保存索引文件)</li>
<li>建立索引文件会占用磁盘空间.(空间换时间)</li>
</ul>
<h2 id="注意事项和优化"><a href="#注意事项和优化" class="headerlink" title="注意事项和优化"></a>注意事项和优化</h2><ol>
<li><p>聚集索引和非聚集索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">//待添加..</span><br></pre></td></tr></table></figure>
</li>
<li><p>索引不会包含有null值的列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">只要列中包含有NULL值都将不会被包含在索引中，</span><br><span class="line">复合索引中只要有一列含有NULL值，</span><br><span class="line">那么这一列对于此复合索引就是无效的。</span><br><span class="line">所以我们在数据库设计时不要让字段的默认值为NULL。</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用短索引</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">对串列进行索引，如果可能应该指定一个前缀长度。</span><br><span class="line">例如，如果有一个CHAR(255)的列，如果在前10个或20个字符内，</span><br><span class="line">多数值是惟一的，那么就不要对整个列进行索引。</span><br><span class="line">短索引不仅可以提高查询速度而且可以节省磁盘空间和I/O操作。</span><br></pre></td></tr></table></figure>
</li>
<li><p>索引列排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MySQL查询只使用一个索引，</span><br><span class="line">因此如果where子句中已经使用了索引的话，</span><br><span class="line">那么order by中的列是不会使用索引的。</span><br><span class="line">因此数据库默认排序可以符合要求的情况下不要使用排序操作；</span><br><span class="line">尽量不要包含多个列的排序，如果需要最好给这些列创建复合索引。</span><br></pre></td></tr></table></figure>
</li>
<li><p>like语句操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">like &quot;%aaa%&quot; 不会使用索引, 而like &quot;aaa%&quot;可以使用索引。</span><br></pre></td></tr></table></figure>
</li>
<li><p>不要在(索引)列上进行运算</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * from users where year(add_date)&lt;2007;</span><br><span class="line">每行进行运算,导致索引失效而进行全表搜索.</span><br><span class="line">可以修改为</span><br><span class="line">select * from users where add_date&lt;&apos;2007-01-01&apos;;</span><br></pre></td></tr></table></figure>

</li>
</ol>
</div></article></div></main><footer><div class="paginator"><a href="/tinytinycn.github.io/2016/07/02/01-jdbc/" class="prev">上一篇</a><a href="/tinytinycn.github.io/2016/06/23/08-mysql-advenced/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://github.com">hang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>