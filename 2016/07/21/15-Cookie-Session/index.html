<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 15_Cookie_Session · hang 's blogs</title><meta name="description" content="15_Cookie_Session - hang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/tinytinycn.github.io/favicon.png"><link rel="stylesheet" href="/tinytinycn.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://github.com/atom.xml" title="hang 's blogs"></head><body><div class="wrap"><header><a href="/tinytinycn.github.io/" class="logo-link"><img src="/tinytinycn.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/tinytinycn.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/tinytinycn.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">15_Cookie_Session</h1><div class="post-info">Jul 21, 2016</div><div class="post-content"><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li>会话</li>
<li>Cookie</li>
<li>Session</li>
</ul>
<hr>
<h2 id="会话"><a href="#会话" class="headerlink" title="会话"></a>会话</h2><p>浏览器访问服务器开始, 直到最后访问服务器结束, 期间多次请求和多次响应的总和, 称为一次会话.</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>将会话产生的数据保存在客户端的技术.</p>
<p>工作原理: 客户端服务端发送请求, 服务器获取需要保存的数据, 通过set-Cookie响应头发送给浏览器, 浏览器以cookie形式保存起来. 客户端下次请求时, 服务器通过请求头Cookie信息获取浏览器发送的信息.</p>
<p>创建Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cookie cookie = new Cookie(String name, String value);</span><br><span class="line">cookie.getName();</span><br><span class="line">cookie.getValue();</span><br><span class="line">cookie.setValue(String value);</span><br></pre></td></tr></table></figure>

<p>添加Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.addCookie(Cookie cookie);//可以多次调用, 添加多个cookie</span><br></pre></td></tr></table></figure>

<p>获取Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">request.getCookies();//获取Cookie对象数组, 没有则为null</span><br></pre></td></tr></table></figure>

<p>删除Cookie</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//间接清除客户端cookie</span><br><span class="line">Cookie cookie = new Cookie(&quot;x_time&quot;, &quot;&quot;);</span><br><span class="line">cookie.setPath(request.getContextPath()+&quot;/&quot;);</span><br><span class="line">cookie.setMaxAge(0);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>Cookie相关方法</p>
<ul>
<li>setMaxAge();</li>
<li>setPath();</li>
</ul>
<h2 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h2><p>将会话产生的数据保存在服务端的技术.</p>
<p>浏览器发送第一次请求时, 服务端获取需要保存的数据, 内部检索有无与当前请求相关的session, 有则直接使用, 无则创建一个新的session, 保存会话数据, 做出响应. 浏览器下次请求时, 服务器可从session中获取与当前浏览器相关而保存下来的会话数据.</p>
<p>Session生命周期:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//操作</span><br><span class="line">HttpSession session = request.getSession();</span><br><span class="line">session.setAttribute(&quot;x_time&quot;, time_str);</span><br><span class="line"></span><br><span class="line">//创建Session: request.getSession(boolean);</span><br><span class="line">服务器内部有与当前请求相关的客户端的session, 设置true则返回一个新建的session; 设置false则返回null</span><br><span class="line"></span><br><span class="line">//销毁Session:</span><br><span class="line">1. 超时销毁: session30分钟未使用,则超时销毁. web.xml可以修改超时时间</span><br><span class="line">2. 自杀销毁: session.invalidate()方法, 立即销毁session</span><br><span class="line">3. 意外销毁: 当服务器非正常关闭时, session会销毁. 当服务器正常关闭时, session会以文件形式保存在服务器work目录下, 这个过程称为session钝化, 当服务器再次启动时, session会被恢复回来, 这个过程称为session活化.</span><br><span class="line"></span><br><span class="line">//Session的作用范围时整个会话期间, 如何获取浏览器上次关闭前的session?</span><br><span class="line">原理: Session创建后, 服务器会将session_id以cookie形式发送给浏览器保存, 浏览器下次请求时, 通过cookie中的session_id带给服务器找到之前那个session.(该cookie默认是会话级别的, 会话结束, cookie将会丢失.)</span><br><span class="line">解决:</span><br><span class="line">Cookie cookie = new Cookie(&quot;JSESSIONID&quot;, session.getId());</span><br><span class="line">cookie.setPath(request.getContextPath()+&quot;/&quot;);</span><br><span class="line">cookie.setMaxAge(1800);</span><br><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<p>session相关方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setAttribute();</span><br><span class="line">getAttribute();</span><br><span class="line">removeAttribute();</span><br><span class="line">getAttributeNames();</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a href="/tinytinycn.github.io/2016/07/21/16-JSP/" class="prev">上一篇</a><a href="/tinytinycn.github.io/2016/07/20/14-Servlet-context/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2019 <a href="http://github.com">hang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>